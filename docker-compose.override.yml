# docker-compose.override.yml
services:
  backend:
    profiles: ["dev"]
    container_name: safe-drive-api-dev
    build:
      context: ./backend
      dockerfile: Dockerfile.dev  # Separate dev Dockerfile
    volumes:
      - ./backend:/app
      - backend_go_cache:/go
      - backend_go_mod_cache:/go/pkg/mod
    environment:
      DB_DSN: "${DB_USER}:${DB_PASSWORD}@tcp(db:3306)/${DB_NAME}?parseTime=true"
      GIN_MODE: debug
    command: >
      sh -c "
        go mod download
      "
    ports:
      - "${API_PORT}:8080"

  frontend:
    profiles: ["dev"]
    container_name: safe-drive-ui-dev
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev  # Separate dev Dockerfile
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules
    environment:
      VITE_API_BASE_URL: "http://localhost:${API_PORT}"
      CHOKIDAR_USEPOLLING: "true"
    command: >
      sh -c "
        npm install &&
        npm run dev -- --host --port 3000
      "
    ports:
      - "${FRONTEND_DEV_PORT}:3000"

volumes:
  backend_go_cache:
  backend_go_mod_cache:
  frontend_node_modules: